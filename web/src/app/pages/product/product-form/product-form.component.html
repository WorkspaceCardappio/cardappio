<p-breadcrumb [model]="items" [home]="home"></p-breadcrumb>

<p-fieldset legend="Novo Produto">
  <form [formGroup]="form" class="p-fluid w-full">
    <div class="card flex justify-center w-full">
      <p-stepper [value]="1" class="w-full flex flex-column">
        <p-step-list>
          <p-step [value]="1">Informações</p-step>
          <p-step [value]="2">Adicionais</p-step>
          <p-step [value]="3">Variáveis</p-step>
          <p-step [value]="4">Ingredientes</p-step>
        </p-step-list>

        <p-step-panels class="w-full flex-1">
          <p-step-panel [value]="1" class="w-full">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="grid w-full mt-4">
                <div class="col-9 flex flex-column mb-4 gap-1">
                  <label for="name" class="required-label">Nome</label>
                  <input id="name" pInputText formControlName="name" placeholder="Nome" />
                </div>

                <div class="col-3 flex flex-column mb-4 gap-1">
                  <label for="quantity" class="required-label">Quantidade</label>
                  <p-inputNumber
                    inputId="quantity"
                    formControlName="quantity"
                    placeholder="Quantidade"
                  ></p-inputNumber>
                </div>

                <div class="col-3 flex flex-column mb-4 gap-1">
                  <label for="price" class="required-label">Preço</label>
                  <p-inputNumber
                    inputId="price"
                    formControlName="price"
                    placeholder="Preço"
                    mode="currency"
                    currency="BRL"
                    locale="pt-BR"
                  ></p-inputNumber>
                </div>

                <div class="col-3 flex flex-column mb-4 gap-1">
                  <label for="expirationDate" class="required-label">Data de validade</label>
                  <p-datepicker
                    formControlName="expirationDate"
                    [showIcon]="true"
                    inputId="expirationDate"
                    [showOnFocus]="true"
                    dateFormat="dd/mm/yy"
                    locale="pt-BR"
                  ></p-datepicker>
                </div>

                <div class="col-6 flex flex-column mb-4 gap-1">
                  <label for="description">Descrição</label>
                  <textarea
                    rows="3"
                    pTextarea
                    formControlName="description"
                  ></textarea>
                </div>

                <div class="col-3 flex flex-column mb-4 gap-1">
                  <label for="active">Ativo</label>
                  <p-toggle-switch
                    inputId="active"
                    formControlName="active"
                  ></p-toggle-switch>
                </div>

                <div class="col-6 flex flex-column mb-4 gap-1">
                  <label for="image">Imagem</label>
                  <p-fileUpload
                    name="image"
                    mode="basic"
                    [auto]="true"
                    customUpload="true"
                    chooseLabel="Escolher Imagem"
                    previewWidth="50"
                    (onSelect)="onFileSelected($event)"
                  ></p-fileUpload>
                  <div *ngIf="imagePreview" class="mt-3">
                    <img
                      [src]="imagePreview"
                      alt="Pré-visualização da imagem"
                      style="max-width: 150px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2)"
                    />
                  </div>
                </div>

                <div class="col-6 flex flex-column mb-4 gap-1">
                  <label for="category" class="required-label">Vincular uma categoria</label>
                  <p-autocomplete
                    formControlName="category"
                    optionLabel="name"
                    [suggestions]="filteredCategories"
                    (completeMethod)="searchCategories($event)"
                    [dropdown]="true"
                    fluid
                  ></p-autocomplete>
                </div>
              </div>

              <div class="flex pt-6 justify-end">
                <p-button
                  label="Próximo"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  (onClick)="activateCallback(2)"
                ></p-button>
              </div>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="2" class="w-full">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="grid w-full mt-4">
                <div class="col-12 md:col-6 flex flex-column mb-4 gap-1">
                  <label for="parent">Escolher um produto</label>
                  <p-autocomplete
                    formControlName="parent"
                    optionLabel="name"
                    [suggestions]="filteredProducts"
                    (completeMethod)="searchProducts($event)"
                    [dropdown]="true"
                    fluid
                  ></p-autocomplete>
                </div>

                <div class="col-12 md:col-3 flex flex-column mb-4 gap-1">
                  <label for="additional_price">Preço</label>
                  <p-inputNumber
                    inputId="additional_price"
                    formControlName="additionalPrice"
                    placeholder="Preço"
                    mode="currency"
                    currency="BRL"
                    locale="pt-BR"
                  ></p-inputNumber>
                </div>

                <div class="col-12 md:col-9 flex flex-column mb-4 gap-1">
                  <label for="note">Observações</label>
                  <textarea
                    rows="4"
                    pTextarea
                    formControlName="note"
                    placeholder="Insira observações sobre o produto"
                  ></textarea>
                </div>
              </div>

              <div class="flex pt-6 justify-content-between">
                <p-button
                  label="Voltar"
                  severity="secondary"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(1)"
                ></p-button>
                <p-button
                  label="Próximo"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  (onClick)="activateCallback(3)"
                ></p-button>
              </div>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="3" class="w-full">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="grid w-full mt-4">
                <div class="col-12 md:col-6 flex flex-column mb-4 gap-1">
                  <label for="product_variable">Cadastrar opção</label>
                  <div class="flex gap-2">
                    <input
                      id="product_variable"
                      pInputText
                      formControlName="product_variable"
                      placeholder="Ex: copo com gelo"
                      class="flex-auto"
                    />
                    <p-button
                      label="Adicionar"
                      icon="pi pi-plus"
                      (onClick)="addProductVariable()"
                    ></p-button>
                  </div>
                </div>
              </div>

              <p-table
                [value]="productVariables"
                [paginator]="true"
                [rows]="5"
                [responsiveLayout]="'scroll'"
                class="mt-4"
              >
                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="name">Nome <p-sortIcon field="name"></p-sortIcon></th>
                    <th style="width: 10rem">Ações</th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-variable>
                  <tr>
                    <td>{{ variable.name }}</td>
                    <td>
                      <button
                        pButton
                        type="button"
                        icon="pi pi-pencil"
                        class="p-button-text p-button-sm"
                        style="margin-right: 0.5rem"
                        aria-label="Editar"
                        (click)="editProductVariable(variable)"
                      ></button>
                      <button
                        pButton
                        type="button"
                        icon="pi pi-trash"
                        class="p-button-text p-button-sm p-button-danger"
                        aria-label="Excluir"
                        (click)="deleteProductVariable(variable)"
                      ></button>
                    </td>
                  </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="2" class="text-center">Nenhuma variável cadastrada.</td>
                  </tr>
                </ng-template>
              </p-table>

              <div class="flex pt-6 justify-content-between">
                <p-button
                  label="Voltar"
                  severity="secondary"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(2)"
                ></p-button>
                <p-button
                  label="Próximo"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  (onClick)="activateCallback(4)"
                ></p-button>
              </div>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="4" class="w-full">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="grid w-full mt-4">
                <div class="col-12 md:col-6 flex flex-column mb-4 gap-1">
                  <label for="ingredient" class="required-label">Escolher um ingrediente</label>
                  <p-autocomplete
                    formControlName="ingredient"
                    optionLabel="name"
                    [suggestions]="filteredIngredients"
                    (completeMethod)="searchIngredients($event)"
                    [dropdown]="true"
                    fluid
                  ></p-autocomplete>
                </div>
              </div>

              <div class="flex pt-6 justify-content-between">
                <p-button
                  label="Voltar"
                  severity="secondary"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(3)"
                ></p-button>
              </div>

              <div class="mt-4 flex justify-content-end gap-2">
                <button
                  pButton
                  type="button"
                  label="Cancelar"
                  class="p-button-secondary"
                  (click)="cancel()"
                ></button>
                <button
                  pButton
                  type="submit"
                  label="Salvar"
                  class="p-button-primary"
                  (click)="create()"
                  [disabled]="form.invalid"
                ></button>
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-panels>
      </p-stepper>
    </div>
  </form>
</p-fieldset>
