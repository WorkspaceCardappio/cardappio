<div class="flex mt-3">
  <p-table
    [value]="initialAdditionals"
    [(selection)]="selectedAdditionals"
    (selectionChange)="onSelectionChange($event)"
    dataKey="id"
    showGridlines
    stripedRows
    style="width: 100%"
    [scrollable]="true"
    scrollHeight="70vh"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem"><p-tableHeaderCheckbox /></th>
        <th>Nome</th>
        <th>Opção</th>
        <th>Quantidade</th>
        <th>Total</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-product>
      <tr>
        <td><p-tableCheckbox [value]="product" /></td>
        <td>{{ product.name }}</td>

        <td [formGroup]="getFormGroupByProductId(product.id)">
          <p-autocomplete
            formControlName="item"
            [suggestions]="product.items"
            [disabled]="!isProductSelected(product.id)"
            [dropdown]="true"
            field=""
            [forceSelection]="true"
            placeholder="Escolha uma opção"
            [style]="{ width: '100%' }"
            (completeMethod)="filterItems(product)"
            appendTo="body"
            [optionLabel]="'label'"
          ></p-autocomplete>
        </td>

        <td [formGroup]="getFormGroupByProductId(product.id)">
          <p-inputNumber
            formControlName="quantity"
            [showButtons]="true"
            [disabled]="!isProductSelected(product.id)"
            [min]="1"
            [max]="20"
            placeholder="Escolha a quantidade"
            [useGrouping]="false"
          ></p-inputNumber>
        </td>

        <td [formGroup]="getFormGroupByProductId(product.id)">
          <p-inputNumber
            inputId="total"
            formControlName="total"
            mode="currency"
            currency="BRL"
            locale="pt-BR"
            [disabled]="true"
          ></p-inputNumber>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr>
        <td colspan="4" class="text-right font-bold">Total Geral:</td>
        <td class="font-bold">
          {{ getTotal() | currency:'BRL':'symbol':'1.2-2' }}
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<div class="mt-4 flex justify-content-end gap-2">
  <button
    pButton
    type="button"
    label="Cancelar"
    severity="danger"
    (click)="prevEmitter.emit()"
  ></button>
  <button
    pButton
    type="button"
    label="Próximo"
    class="p-button-primary"
    (click)="onSave()"
  ></button>
</div>
